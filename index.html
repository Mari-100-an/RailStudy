<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="철도면허">
    <meta name="theme-color" content="#3b82f6">
    <meta name="description" content="제2종 전기차량운전면허 시험 준비를 위한 학습 앱">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- 아이콘 -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="192x192" href="/web-app-manifest-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/web-app-manifest-512x512.png">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="192x192" href="/web-app-manifest-192x192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="/web-app-manifest-512x512.png">
    
    <title>제2종 전기차량운전면허 학습 플랫폼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/game-mode.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Noto Sans KR', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body class="game-mode font-sans min-h-screen transition-colors duration-300">
    <!-- 로딩 스크린 -->
    <div id="loading-screen" class="fixed inset-0 z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="loading-spinner mb-4"></div>
            <p class="text-lg font-medium">학습 플랫폼 로딩 중...</p>
        </div>
    </div>

    <!-- 메인 앱 컨테이너 -->
    <div id="app" class="hidden">
        <!-- 헤더 -->
        <header id="main-header" class="sticky top-0 z-40" style="border-bottom: 1px solid rgba(71, 85, 105, 0.3); background-color: rgba(10, 15, 28, 0.95); backdrop-filter: blur(8px);">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between">
                <button id="logo-btn" class="p-2 hover:bg-gray-100 rounded-lg transition">
                    <i class="fas fa-train text-2xl text-primary"></i>
                </button>
                
                <nav class="flex items-center gap-2">
                    <button id="nav-home" class="nav-btn active" title="홈">
                        <i class="fas fa-home"></i>
                    </button>
                    <button id="nav-review" class="nav-btn" title="오답 노트">
                        <i class="fas fa-book"></i>
                        <span class="nav-label">오답</span>
                    </button>
                    <button id="nav-dashboard" class="nav-btn" title="대시보드">
                        <i class="fas fa-chart-bar"></i>
                    </button>
                    <button id="nav-settings" class="nav-btn" title="설정">
                        <i class="fas fa-cog"></i>
                    </button>
                </nav>
            </div>
        </header>

        <!-- 게임 모드 XP 바 (새로 구축) -->
        <div id="new-xp-bar" style="border-bottom: 1px solid rgba(71, 85, 105, 0.3); background-color: rgba(30, 41, 59, 0.5); backdrop-filter: blur(4px);">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-2 sm:py-2.5">
                <div class="flex items-center gap-3">
                    <span id="new-level-badge" class="flex-shrink-0 text-xs px-3 py-1.5 rounded-full font-bold text-white" style="background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%); box-shadow: 0 0 15px rgba(139, 92, 246, 0.5);">
                        <span id="new-level-icon">🌱</span> Lv.1
                    </span>
                    <div class="flex-1 h-4 rounded-lg overflow-hidden" style="background-color: rgba(251, 191, 36, 0.15); border: 1px solid rgba(251, 191, 36, 0.3);">
                        <div id="new-xp-fill" class="h-full" style="width: 45%; background: linear-gradient(90deg, #FBBF24 0%, #F59E0B 100%); box-shadow: 0 0 15px rgba(251, 191, 36, 0.5), inset 0 1px 2px rgba(255,255,255,0.3);"></div>
                    </div>
                    <span id="new-xp-text" class="text-xs font-medium flex-shrink-0" style="color: #FBBF24;">45/100</span>
                </div>
            </div>
        </div>

        <!-- 메인 콘텐츠 영역 -->
        <main id="main-content" class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-5 lg:py-6">
            <!-- 홈 페이지 -->
            <section id="page-home" class="page active">
                <div class="max-w-4xl mx-auto">
                    <!-- 환영 메시지 -->
                    <div class="welcome-card mb-6 sm:mb-8 p-4 sm:p-6 rounded-2xl">
                        <h2 class="text-xl sm:text-2xl font-bold mb-2">안녕하세요, 예비 기관사님! 🚄</h2>
                        <p class="text-base sm:text-lg opacity-80">제2종 전기차량 운전면허 준비를 도와드릴게요.</p>
                    </div>

                    <!-- 이어서 풀기 (마지막 세션이 있을 때만 표시) -->
                    <div id="continue-session-card" class="hidden mb-6 sm:mb-8 p-4 sm:p-6 rounded-xl bg-gradient-to-r from-green-500/10 to-emerald-500/10 border border-green-500/30">
                        <div class="flex items-center justify-between flex-wrap gap-3">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 rounded-full bg-green-500/20 flex items-center justify-center">
                                    <i class="fas fa-play text-green-500 text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg">이어서 풀기</h3>
                                    <p id="continue-session-info" class="text-sm opacity-70">도시철도시스템 > 7단원 (5/20)</p>
                                </div>
                            </div>
                            <button onclick="App.continueLastSession()" class="px-5 py-2.5 bg-green-500 text-white rounded-lg hover:bg-green-600 transition font-medium">
                                <i class="fas fa-arrow-right mr-2"></i>계속하기
                            </button>
                        </div>
                    </div>

                    <!-- 빠른 문제 풀이 (메인 기능) -->
                    <div class="mb-6 sm:mb-8 p-4 sm:p-6 rounded-xl bg-gradient-to-r from-blue-500/10 to-purple-500/10 border border-blue-500/20">
                        <h3 class="text-lg sm:text-xl font-bold mb-2 sm:mb-3 flex items-center gap-2">
                            <i class="fas fa-play-circle text-blue-500"></i>
                            빠른 문제 풀이
                        </h3>
                        <p class="text-sm opacity-70 mb-3 sm:mb-4">바로 문제를 풀어보세요!</p>
                        <div class="flex flex-wrap gap-2 sm:gap-3">
                            <button onclick="Quiz.startRandomQuiz(); App.navigateTo('quiz');" class="px-4 py-2.5 sm:px-5 sm:py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition font-medium text-sm sm:text-base">
                                <i class="fas fa-random mr-1 sm:mr-2"></i>랜덤 문제
                            </button>
                            <button onclick="if(Quiz.startWrongQuiz()) App.navigateTo('quiz'); else showToast('오답이 없습니다', 'info');" class="px-4 py-2.5 sm:px-5 sm:py-3 border-2 border-blue-500 text-blue-600 rounded-lg hover:bg-blue-50 transition font-medium text-sm sm:text-base">
                                <i class="fas fa-redo mr-1 sm:mr-2"></i>오답 복습
                            </button>
                        </div>
                    </div>

                    <!-- 과목별 문제 -->
                    <h3 class="text-lg sm:text-xl font-bold mb-3 sm:mb-4">📚 과목별 문제</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 mb-6 sm:mb-8" id="subject-cards">
                        <!-- JavaScript에서 동적 생성 -->
                    </div>

                    <!-- 학습 통계 미리보기 -->
                    <div class="stats-preview p-4 sm:p-6 rounded-xl">
                        <h3 class="text-base sm:text-lg font-bold mb-3 sm:mb-4">📊 오늘의 학습 현황</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4">
                            <div class="stat-item text-center p-3 sm:p-4 rounded-lg">
                                <div id="stat-solved" class="text-2xl sm:text-3xl font-bold text-primary">0</div>
                                <div class="text-xs sm:text-sm opacity-70">푼 문제</div>
                            </div>
                            <div class="stat-item text-center p-3 sm:p-4 rounded-lg">
                                <div id="stat-correct" class="text-2xl sm:text-3xl font-bold text-green-500">0</div>
                                <div class="text-xs sm:text-sm opacity-70">정답</div>
                            </div>
                            <div class="stat-item text-center p-3 sm:p-4 rounded-lg">
                                <div id="stat-accuracy" class="text-2xl sm:text-3xl font-bold text-blue-500">0%</div>
                                <div class="text-xs sm:text-sm opacity-70">정답률</div>
                            </div>
                            <div class="stat-item text-center p-3 sm:p-4 rounded-lg">
                                <div id="stat-streak" class="text-2xl sm:text-3xl font-bold text-orange-500">0</div>
                                <div class="text-xs sm:text-sm opacity-70">연속 정답</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 퀴즈 페이지 -->
            <section id="page-quiz" class="page hidden">
                <div class="max-w-3xl mx-auto">
                    <!-- 퀴즈 시작 선택 화면 -->
                    <div id="quiz-start-selection" class="max-w-2xl mx-auto">
                        <h2 class="text-2xl font-bold mb-6">📝 문제 풀이</h2>

                        <!-- 이어서 풀기 (진행 중인 세션이 있을 때) -->
                        <div id="quiz-continue-card" class="hidden mb-6 p-5 rounded-2xl bg-gradient-to-r from-green-500/10 to-emerald-500/10 border-2 border-green-500/30">
                            <div class="flex items-start gap-4">
                                <div class="text-3xl">▶️</div>
                                <div class="flex-1">
                                    <h3 class="text-xl font-bold mb-1">이어서 풀기</h3>
                                    <p id="quiz-continue-info" class="text-sm opacity-70 mb-3">도시철도시스템 > 7단원</p>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex-1 h-2 bg-gray-200 rounded-full overflow-hidden">
                                            <div id="quiz-continue-progress" class="h-full bg-green-500 rounded-full" style="width: 25%"></div>
                                        </div>
                                        <span id="quiz-continue-count" class="text-sm font-medium">5/20</span>
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick="App.continueLastSession()" class="flex-1 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition font-medium text-sm">
                                            <i class="fas fa-play mr-1"></i>이어서 풀기
                                        </button>
                                        <button onclick="App.restartLastSession()" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition text-sm">
                                            <i class="fas fa-redo mr-1"></i>처음부터
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="grid gap-4 mb-6">
                            <!-- 랜덤 문제 풀이 -->
                            <button onclick="Quiz.startRandomQuiz()" class="quiz-start-option p-6 rounded-2xl text-left transition-all hover:scale-105">
                                <div class="flex items-center gap-4">
                                    <div class="text-4xl">🎲</div>
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold mb-1">랜덤 문제 풀이</h3>
                                        <p class="text-sm opacity-70">전체 과목에서 랜덤으로 문제를 선택합니다</p>
                                    </div>
                                    <i class="fas fa-arrow-right text-2xl"></i>
                                </div>
                            </button>

                            <!-- 오답 문제 풀이 -->
                            <button onclick="Quiz.startWrongQuiz()" class="quiz-start-option p-6 rounded-2xl text-left transition-all hover:scale-105">
                                <div class="flex items-center gap-4">
                                    <div class="text-4xl">❌</div>
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold mb-1">오답 문제 풀이</h3>
                                        <p class="text-sm opacity-70">틀렸던 문제를 다시 풀어봅니다</p>
                                        <span id="wrong-count-badge" class="text-xs px-2 py-1 rounded-full bg-red-500/20 text-red-500 font-medium">0개</span>
                                    </div>
                                    <i class="fas fa-arrow-right text-2xl"></i>
                                </div>
                            </button>

                            <!-- 과목별 풀이 -->
                            <button onclick="App.showSubjectModal('quiz')" class="quiz-start-option p-6 rounded-2xl text-left transition-all hover:scale-105">
                                <div class="flex items-center gap-4">
                                    <div class="text-4xl">📚</div>
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold mb-1">과목/단원별 문제 풀이</h3>
                                        <p class="text-sm opacity-70">과목과 단원을 선택하여 학습합니다</p>
                                    </div>
                                    <i class="fas fa-arrow-right text-2xl"></i>
                                </div>
                            </button>
                        </div>
                    </div>

                    <!-- 퀴즈 진행 상황 -->
                    <div id="quiz-progress" class="hidden mb-6">
                        <div class="flex justify-between items-center mb-2">
                            <span id="quiz-progress-text" class="font-medium">문제 1 / 10</span>
                            <span id="quiz-subject-badge" class="subject-badge">전기동차</span>
                        </div>
                        <div class="progress-bar-bg">
                            <div id="quiz-progress-bar" class="progress-bar-fill" style="width: 10%"></div>
                        </div>
                    </div>

                    <!-- 문제 카드 -->
                    <div id="quiz-card" class="quiz-card p-6 rounded-2xl mb-6">
                        <div id="question-number" class="text-sm font-medium mb-2 opacity-70">Q.1</div>
                        <h2 id="question-text" class="text-xl font-bold mb-6 leading-relaxed">
                            문제가 여기에 표시됩니다.
                        </h2>
                        
                        <!-- 선택지 -->
                        <div id="options-container" class="space-y-3">
                            <!-- JavaScript에서 동적 생성 -->
                        </div>
                    </div>

                    <!-- 정답 해설 (채점 후 표시) -->
                    <div id="answer-explanation" class="hidden explanation-card p-6 rounded-xl mb-6">
                        <div id="answer-result" class="flex items-center gap-3 mb-4">
                            <i class="fas fa-check-circle text-2xl"></i>
                            <span class="text-xl font-bold">정답입니다!</span>
                        </div>
                        <div id="explanation-text" class="leading-relaxed">
                            해설이 여기에 표시됩니다.
                        </div>
                        <div id="source-reference" class="mt-4 text-sm opacity-70 border-t pt-4">
                            <i class="fas fa-book-open mr-2"></i>
                            <span>출처: 표준교재</span>
                        </div>
                    </div>

                    <!-- 정답 확인 버튼 -->
                    <div id="submit-container" class="flex justify-center mb-6">
                        <button id="btn-submit" class="btn-primary px-8 py-3 rounded-lg font-bold">
                            <i class="fas fa-check mr-2"></i>정답 확인
                        </button>
                    </div>

                    <!-- 이전/다음 네비게이션 (하단) -->
                    <div id="nav-buttons" class="hidden flex justify-between items-center gap-3">
                        <button id="btn-prev" class="flex-1 btn-primary px-8 py-3 rounded-lg font-bold disabled:opacity-40 disabled:cursor-not-allowed">
                            <i class="fas fa-chevron-left mr-2"></i>이전 문제
                        </button>
                        <button id="btn-next-nav" class="flex-1 btn-primary px-8 py-3 rounded-lg font-bold disabled:opacity-40 disabled:cursor-not-allowed">
                            다음 문제<i class="fas fa-chevron-right ml-2"></i>
                        </button>
                    </div>

                    <!-- 게임 모드 보너스 표시 -->
                    <div id="game-bonus" class="hidden fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50">
                        <div class="bonus-popup text-center p-6 rounded-2xl">
                            <div class="text-4xl mb-2">🎉</div>
                            <div class="text-2xl font-bold">+<span id="bonus-xp">10</span> XP</div>
                            <div id="combo-text" class="text-lg">연속 정답!</div>
                        </div>
                    </div>
                </div>

                <!-- 퀴즈 결과 화면 -->
                <div id="quiz-result" class="hidden max-w-2xl mx-auto">
                    <div class="result-card p-6 sm:p-8 rounded-2xl text-center">
                        <div id="result-icon" class="text-5xl sm:text-6xl mb-3 sm:mb-4">🎊</div>
                        <h2 class="text-2xl sm:text-3xl font-bold mb-2">학습 완료!</h2>
                        <p id="result-message" class="text-base sm:text-lg opacity-80 mb-4 sm:mb-6">수고하셨습니다!</p>
                        
                        <div class="grid grid-cols-3 gap-3 sm:gap-4 mb-6 sm:mb-8">
                            <div class="result-stat p-3 sm:p-4 rounded-xl">
                                <div id="result-total" class="text-2xl sm:text-3xl font-bold">10</div>
                                <div class="text-xs sm:text-sm opacity-70">전체 문제</div>
                            </div>
                            <div class="result-stat p-3 sm:p-4 rounded-xl">
                                <div id="result-correct" class="text-2xl sm:text-3xl font-bold text-green-500">8</div>
                                <div class="text-xs sm:text-sm opacity-70">정답</div>
                            </div>
                            <div class="result-stat p-3 sm:p-4 rounded-xl">
                                <div id="result-accuracy" class="text-2xl sm:text-3xl font-bold text-blue-500">80%</div>
                                <div class="text-xs sm:text-sm opacity-70">정답률</div>
                            </div>
                        </div>

                        <!-- 게임 모드 보상 -->
                        <div id="result-rewards" class="hidden mb-6 sm:mb-8 p-4 rounded-xl bg-gradient-to-r from-yellow-500/20 to-orange-500/20">
                            <h3 class="font-bold mb-2 text-sm sm:text-base">🏆 획득한 보상</h3>
                            <div class="flex justify-center gap-4 sm:gap-6 text-sm sm:text-base">
                                <div><span id="earned-xp" class="text-lg sm:text-xl font-bold">+100</span> XP</div>
                                <div id="earned-badge" class="hidden"><span class="text-lg sm:text-xl">🎖️</span> 새 배지!</div>
                            </div>
                        </div>

                        <div class="flex flex-col sm:flex-row justify-center gap-2 sm:gap-4">
                            <button id="btn-retry" class="btn-secondary px-4 py-2 sm:px-6 sm:py-3 rounded-lg text-sm sm:text-base">
                                <i class="fas fa-redo mr-1 sm:mr-2"></i>다시 풀기
                            </button>
                            <button id="btn-review-wrong" class="btn-primary px-4 py-2 sm:px-6 sm:py-3 rounded-lg text-sm sm:text-base">
                                <i class="fas fa-book mr-1 sm:mr-2"></i>오답 복습
                            </button>
                            <button id="btn-home" class="btn-secondary px-4 py-2 sm:px-6 sm:py-3 rounded-lg text-sm sm:text-base">
                                <i class="fas fa-home mr-1 sm:mr-2"></i>홈으로
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 오답 노트 페이지 -->
            <section id="page-review" class="page hidden">
                <div class="max-w-4xl mx-auto">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold mb-4">📝 오답</h2>
                        <div class="flex flex-col sm:flex-row gap-2">
                            <select id="review-filter" class="filter-select px-3 py-2 rounded-lg text-sm flex-1">
                                <option value="all">전체 과목</option>
                                <option value="law">철도관련법</option>
                                <option value="urban">도시철도시스템</option>
                                <option value="emu">전기동차 구조</option>
                                <option value="theory">운전이론</option>
                            </select>
                            <button id="btn-clear-review" class="btn-secondary px-3 py-2 rounded-lg text-sm whitespace-nowrap">
                                <i class="fas fa-trash mr-1"></i>전체 삭제
                            </button>
                        </div>
                    </div>

                    <div id="review-empty" class="text-center py-16">
                        <i class="fas fa-check-circle text-6xl text-green-500 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">오답이 없습니다!</h3>
                        <p class="opacity-70">틀린 문제가 없거나, 모두 복습을 완료했습니다.</p>
                    </div>

                    <div id="review-list" class="space-y-4">
                        <!-- JavaScript에서 동적 생성 -->
                    </div>

                    <div id="review-actions" class="hidden mt-6 flex justify-center">
                        <button id="btn-practice-wrong" class="btn-primary px-6 py-2 rounded-lg text-sm font-bold">
                            <i class="fas fa-redo mr-1"></i>오답 다시 풀기
                        </button>
                    </div>
                </div>
            </section>

            <!-- 대시보드 페이지 -->
            <section id="page-dashboard" class="page hidden">
                <div class="max-w-6xl mx-auto">
                    <h2 class="text-2xl font-bold mb-6">🎮 대시보드</h2>

                    <!-- 게임 통계 -->
                    <h3 class="text-xl font-bold mb-4">게임 통계</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                        <div class="game-stat-card p-4 rounded-xl text-center">
                            <div class="text-3xl mb-2">🏆</div>
                            <div id="game-level" class="text-xl font-bold">Level 1</div>
                            <div class="text-sm opacity-70">현재 레벨</div>
                        </div>
                        <div class="game-stat-card p-4 rounded-xl text-center">
                            <div class="text-3xl mb-2">⭐</div>
                            <div id="game-total-xp" class="text-xl font-bold">0 XP</div>
                            <div class="text-sm opacity-70">총 경험치</div>
                        </div>
                        <div class="game-stat-card p-4 rounded-xl text-center">
                            <div class="text-3xl mb-2">🔥</div>
                            <div id="game-max-combo" class="text-xl font-bold">0</div>
                            <div class="text-sm opacity-70">최대 콤보</div>
                        </div>
                        <div class="game-stat-card p-4 rounded-xl text-center">
                            <div class="text-3xl mb-2">🎖️</div>
                            <div id="game-badges" class="text-xl font-bold">0개</div>
                            <div class="text-sm opacity-70">획득 배지</div>
                        </div>
                    </div>

                    <!-- 배지 컬렉션 -->
                    <div class="badge-collection p-6 rounded-xl">
                        <h3 class="text-xl font-bold mb-4">배지 컬렉션</h3>
                        <div id="badge-grid" class="grid grid-cols-4 md:grid-cols-8 gap-4">
                            <!-- JavaScript에서 동적 생성 -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- 설정 페이지 -->
            <section id="page-settings" class="page hidden">
                <div class="max-w-2xl mx-auto">
                    <h2 class="text-2xl font-bold mb-6">⚙️ 설정</h2>

                    <!-- 학습 설정 -->
                    <div class="settings-card p-6 rounded-xl mb-6">
                        <h3 class="text-lg font-bold mb-4">📚 학습 설정</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <div>
                                    <div class="font-medium">문제 수</div>
                                    <div class="text-sm opacity-70">한 세션당 문제 수</div>
                                </div>
                                <select id="setting-question-count" class="setting-select px-4 py-2 rounded-lg">
                                    <option value="5">5문제</option>
                                    <option value="10" selected>10문제</option>
                                    <option value="20">20문제</option>
                                    <option value="30">30문제</option>
                                </select>
                            </div>
                            <div class="flex justify-between items-center">
                                <div>
                                    <div class="font-medium">문제 순서</div>
                                    <div class="text-sm opacity-70">문제 출제 방식</div>
                                </div>
                                <select id="setting-order" class="setting-select px-4 py-2 rounded-lg">
                                    <option value="random" selected>랜덤</option>
                                    <option value="sequential">순차</option>
                                    <option value="wrong-first">오답 우선</option>
                                </select>
                            </div>
                            <div class="flex justify-between items-center">
                                <div>
                                    <div class="font-medium">즉시 채점</div>
                                    <div class="text-sm opacity-70">답 선택 즉시 결과 표시</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="setting-instant-feedback" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- 사운드 설정 -->
                    <div class="settings-card p-6 rounded-xl mb-6">
                        <h3 class="text-lg font-bold mb-4">🔊 사운드 설정</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <div>
                                    <div class="font-medium">효과음</div>
                                    <div class="text-sm opacity-70">정답/오답 피드백 소리</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="setting-sfx-enabled" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="flex justify-between items-center">
                                <div>
                                    <div class="font-medium">배경음악</div>
                                    <div class="text-sm opacity-70">집중 로파이 비트</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="setting-bgm-enabled">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <button id="btn-test-sound" class="w-full btn-secondary py-2 rounded-lg text-sm">
                                <i class="fas fa-volume-up mr-2"></i>사운드 테스트
                            </button>
                        </div>
                    </div>

                    <!-- 데이터 관리 -->
                    <div class="settings-card p-6 rounded-xl">
                        <h3 class="text-lg font-bold mb-4">💾 데이터 관리</h3>
                        <div class="space-y-3">
                            <button id="btn-export-data" class="w-full btn-secondary py-3 rounded-lg">
                                <i class="fas fa-download mr-2"></i>학습 데이터 내보내기
                            </button>
                            <button id="btn-reset-data" class="w-full btn-danger py-3 rounded-lg">
                                <i class="fas fa-trash mr-2"></i>모든 데이터 초기화
                            </button>
                        </div>
                    </div>

                    <!-- 앱 정보 -->
                    <div class="mt-8 text-center text-sm opacity-60">
                        <p>제2종 전기차량운전면허 학습 플랫폼</p>
                        <p class="mt-1" id="app-version">버전 v5.5</p>
                    </div>
                </div>
            </section>
        </main>

        <!-- 과목 선택 모달 -->
        <div id="modal-subject" class="modal hidden fixed inset-0 z-50 flex items-center justify-center overflow-hidden">
            <div class="modal-backdrop absolute inset-0 bg-black/50" onclick="closeModal()"></div>
            <div class="modal-content relative bg-white rounded-2xl p-6 max-w-md w-full mx-4 max-h-[80vh] overflow-y-auto overflow-x-hidden">
                <h3 class="text-xl font-bold mb-4">과목 선택</h3>
                <div id="modal-subject-list" class="space-y-2">
                    <!-- JavaScript에서 동적 생성 -->
                </div>
                <button onclick="closeModal()" class="mt-4 w-full btn-secondary py-3 rounded-lg">취소</button>
            </div>
        </div>

        <!-- 배지 상세 모달 -->
        <div id="badge-detail-modal" class="modal fixed inset-0 z-50 hidden items-center justify-center bg-black/50">
            <div class="modal-content bg-white rounded-2xl p-8 max-w-md mx-4 text-center">
                <div id="badge-detail-icon" class="text-8xl mb-4">🎖️</div>
                <h3 id="badge-detail-name" class="text-2xl font-bold mb-2">배지 이름</h3>
                <p id="badge-detail-description" class="text-gray-600 mb-6">배지 설명</p>
                <button onclick="closeBadgeDetailModal()" class="btn-primary px-8 py-3 rounded-lg font-bold">
                    닫기
                </button>
            </div>
        </div>

        <!-- 토스트 메시지 -->
        <div id="toast" class="fixed bottom-4 right-4 z-50 hidden">
            <div class="toast-content px-6 py-3 rounded-lg shadow-lg flex items-center gap-3">
                <i id="toast-icon" class="fas fa-check-circle"></i>
                <span id="toast-message">메시지</span>
            </div>
        </div>
    </div>

    <!-- JavaScript 파일 로드 -->
    <!-- Questions - Subjects -->
    <script src="data/questions/subjects.js"></script>
    
    <!-- Questions - Law (10단원) -->
    <script src="data/questions/law/ch1.js"></script>
    <script src="data/questions/law/ch2.js"></script>
    <script src="data/questions/law/ch3.js"></script>
    <script src="data/questions/law/ch4.js"></script>
    <script src="data/questions/law/ch5.js"></script>
    <script src="data/questions/law/ch6.js"></script>
    <script src="data/questions/law/ch7.js"></script>
    <script src="data/questions/law/ch8.js"></script>
    <script src="data/questions/law/ch9.js"></script>
    <script src="data/questions/law/ch10.js"></script>
    <script src="data/questions/law/index.js"></script>
    
    <!-- Questions - Urban (11단원) -->
    <script src="data/questions/urban/ch1.js"></script>
    <script src="data/questions/urban/ch2.js"></script>
    <script src="data/questions/urban/ch3.js"></script>
    <script src="data/questions/urban/ch4.js"></script>
    <script src="data/questions/urban/ch5.js"></script>
    <script src="data/questions/urban/ch6.js"></script>
    <script src="data/questions/urban/ch7.js"></script>
    <script src="data/questions/urban/ch8.js"></script>
    <script src="data/questions/urban/ch9.js"></script>
    <script src="data/questions/urban/ch10.js"></script>
    <script src="data/questions/urban/ch11.js"></script>
    <script src="data/questions/urban/index.js"></script>
    
    <!-- Questions - EMU (7단원) -->
    <script src="data/questions/emu/ch1.js"></script>
    <script src="data/questions/emu/ch2.js"></script>
    <script src="data/questions/emu/ch3.js"></script>
    <script src="data/questions/emu/ch4.js"></script>
    <script src="data/questions/emu/ch5.js"></script>
    <script src="data/questions/emu/ch6.js"></script>
    <script src="data/questions/emu/ch7.js"></script>
    <script src="data/questions/emu/index.js"></script>
    
    <!-- Questions - Theory (9단원) -->
    <script src="data/questions/theory/ch1.js"></script>
    <script src="data/questions/theory/ch2.js"></script>
    <script src="data/questions/theory/ch3.js"></script>
    <script src="data/questions/theory/ch4.js"></script>
    <script src="data/questions/theory/ch5.js"></script>
    <script src="data/questions/theory/ch6.js"></script>
    <script src="data/questions/theory/ch7.js"></script>
    <script src="data/questions/theory/ch8.js"></script>
    <script src="data/questions/theory/ch9.js"></script>
    <script src="data/questions/theory/index.js"></script>
    
    <!-- Questions - Emergency (3단원) -->
    <script src="data/questions/emergency/ch1.js"></script>
    <script src="data/questions/emergency/ch2.js"></script>
    <script src="data/questions/emergency/ch3.js"></script>
    <script src="data/questions/emergency/index.js"></script>
    
    <!-- Questions - Main Index -->
    <script src="data/questions/index.js"></script>
    
    <!-- App Scripts -->
    <script src="js/storage.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/sound.js"></script>
    <script src="js/gamification.js"></script>
    <script src="js/heatmap.js"></script>
    <script src="js/quiz.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/app.js"></script>
    
    <!-- 유틸리티 함수 -->
    <script>
        function closeBadgeDetailModal() {
            const modal = document.getElementById('badge-detail-modal');
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }
        }
    </script>
    
    <!-- Service Worker 등록 (PWA) -->
    <script>
        if ('serviceWorker' in navigator) {
            let refreshing = false;

            // Service Worker 업데이트 감지
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                if (!refreshing) {
                    refreshing = true;
                    window.location.reload();
                }
            });

            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then((registration) => {
                        console.log('✅ ServiceWorker registered:', registration.scope);
                        
                        // 업데이트 확인
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // 새 버전 사용 가능
                                    showToast('새 버전이 있습니다. 곧 업데이트됩니다...', 'info');
                                    
                                    // 3초 후 자동 업데이트
                                    setTimeout(() => {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                    }, 3000);
                                }
                            });
                        });
                        
                        // 주기적 업데이트 확인 (1시간마다)
                        setInterval(() => {
                            registration.update();
                        }, 60 * 60 * 1000);
                    })
                    .catch((error) => {
                        console.log('❌ ServiceWorker registration failed:', error);
                    });
            });
        }
        
        // PWA 설치 프롬프트
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('💾 App install available');
            
            // 설치 버튼 표시 (선택사항)
            // showInstallButton();
        });
        
        window.addEventListener('appinstalled', () => {
            console.log('✅ PWA installed successfully');
            deferredPrompt = null;
        });
    </script>
    <!-- Debug Script -->
    <script>
        console.log('=== Checking Global Variables ===');
        console.log('SUBJECTS:', typeof SUBJECTS !== 'undefined' ? SUBJECTS : 'NOT DEFINED');
        console.log('QUESTIONS:', typeof QUESTIONS !== 'undefined' ? QUESTIONS.length : 'NOT DEFINED');
        console.log('App:', typeof App !== 'undefined' ? 'DEFINED' : 'NOT DEFINED');
        console.log('=================================');
    </script>
</body>
</html>
